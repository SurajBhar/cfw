# @package _global_

# CFW Experiment: ViT-B/16 on Multi-Class Classification
# CFW dataloader (Dataloader B) with weighted sampling

defaults:
  - override /dataset: driveact_multiclass
  - override /model: vit_b_16
  - override /dataloader: cfw
  - override /trainer: single_gpu
  - override /optimizer: adam
  - override /scheduler: cosine_annealing
  - override /augmentation: no_aug

# Experiment name
experiment:
  name: cfw_vit_b_16_driveact_multiclass
  seed: 42

# Dataset paths (env-driven with local fallback)
dataset:
  data_root: ${oc.env:CFW_DRIVEACT_MULTICLASS_SPLIT0_DIR,./data/processed/daa_multiclass_kinect_color/split_0}
  train_dir: ${dataset.data_root}/train
  val_dir: ${dataset.data_root}/val
  test_dir: ${dataset.data_root}/test

# CFW feature paths (pre-extracted features required)
# Note: Multiclass features need to be extracted separately - paths to be updated
dataloader:
  batch_size: 1024
  cfw:
    cfw_train_only: true
    # Training features - multiclass Split 0 (extract using scripts/extract_features.py)
    train_feature_file: ${oc.env:CFW_CFW_MULTICLASS_FEATURE_SPLIT0_DIR,./data/features/driveact_multiclass/split_0/train}/features.pkl
    train_label_file: ${oc.env:CFW_CFW_MULTICLASS_FEATURE_SPLIT0_DIR,./data/features/driveact_multiclass/split_0/train}/labels.pkl
    train_img_path_file: ${oc.env:CFW_CFW_MULTICLASS_FEATURE_SPLIT0_DIR,./data/features/driveact_multiclass/split_0/train}/image_paths.pkl

    # Note: Validation and test use standard image loading, not pre-extracted features
    # The original implementation only uses pre-extracted features for training data

    # CFW hyperparameters (may need tuning for multi-class)
    clustering_batch_size: ${..batch_size}
    clustering:
      min_cluster_size: 15  # Smaller clusters for multi-class
      min_samples: 1
    weighting:
      outlier_weight: 0.001
      max_outlier_cluster_size: 50

# Training settings
trainer:
  num_epochs: 100
  device: 0

# Optimizer settings
optimizer:
  lr: 0.0005
  weight_decay: 0.0001

# Scheduler settings
scheduler:
  T_max: ${trainer.num_epochs}
  eta_min: 0.0
